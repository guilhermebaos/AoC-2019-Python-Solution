# Requires 13312 ORE
reactions_test1 = [['ORE', 'NZVS'], ['ORE', 'DCFZ'], ['XJWVT', 'KHKGT', 'QDVJ', 'NZVS', 'GPVTF', 'HKGWZ', 'FUEL'], ['HKGWZ', 'GPVTF', 'PSHF', 'QDVJ'], ['ORE', 'PSHF'], ['ORE', 'HKGWZ'], ['DCFZ', 'PSHF', 'XJWVT'], ['ORE', 'GPVTF'], ['DCFZ', 'NZVS', 'HKGWZ', 'PSHF', 'KHKGT']]
numbers_test1 = [[157, 5], [165, 6], [44, 5, 1, 29, 9, 48, 1], [12, 1, 8, 9], [179, 7], [177, 5], [7, 7, 2], [165, 2], [3, 7, 5, 10, 8]]

# Requires 180697 ORE
reactions_test2 = [['VPVL', 'FWMGM', 'CXFTF', 'MNCFX', 'STKFG'], ['NVRVD', 'JNWZP', 'VPVL'], ['STKFG', 'MNCFX', 'VJHF', 'HVMC', 'CXFTF', 'GNMV', 'FUEL'], ['VJHF', 'MNCFX', 'FWMGM'], ['ORE', 'NVRVD'], ['ORE', 'JNWZP'], ['MNCFX', 'RFSQX', 'FWMGM', 'VPVL', 'CXFTF', 'HVMC'], ['VJHF', 'MNCFX', 'VPVL', 'CXFTF', 'GNMV'], ['ORE', 'MNCFX'], ['NVRVD', 'CXFTF'], ['VJHF', 'MNCFX', 'RFSQX'], ['ORE', 'VJHF']]
numbers_test2 = [[2, 7, 2, 11, 1], [17, 3, 8], [53, 6, 46, 81, 68, 25, 1], [22, 37, 5], [139, 4], [144, 7], [5, 7, 2, 2, 19, 3], [5, 7, 9, 37, 6], [145, 6], [1, 8], [1, 6, 4], [176, 6]]

# Requires 2210736 ORE
reactions_test3 = [['ORE', 'CNZTR'], ['ZLQW', 'BMBT', 'XCVML', 'XMNCP', 'WPTQ', 'MZWV', 'RJRHP', 'PLWSL'], ['ORE', 'BHXH'], ['VRPVC', 'BMBT'], ['BHXH', 'KTJDG', 'WPTQ', 'PLWSL', 'FHTLT', 'ZDVW', 'FUEL'], ['WPTQ', 'BMBT', 'ZLQW', 'KTJDG', 'XMNCP', 'MZWV', 'RJRHP', 'FHTLT'], ['XDBXC', 'LTCX', 'VRPVC', 'ZLQW'], ['WPTQ', 'LTCX', 'RJRHP', 'XMNCP', 'MZWV', 'ZLQW', 'ZDVW'], ['BMBT', 'WPTQ'], ['ORE', 'KTJDG'], ['MZWV', 'XDBXC', 'XCVML', 'XMNCP'], ['VRPVC', 'CNZTR', 'XDBXC'], ['KTJDG', 'BHXH', 'XCVML'], ['BHXH', 'VRPVC', 'MZWV'], ['ORE', 'VRPVC'], ['XCVML', 'RJRHP'], ['BHXH', 'VRPVC', 'LTCX']]
numbers_test3 = [[171, 8], [7, 3, 9, 26, 1, 2, 1, 4], [114, 4], [14, 6], [6, 18, 12, 7, 31, 37, 1], [6, 2, 8, 18, 1, 6, 1, 6], [15, 2, 1, 6], [13, 10, 3, 14, 2, 1, 1], [5, 4], [189, 9], [1, 17, 3, 2], [12, 27, 2], [15, 12, 5], [3, 2, 7], [121, 7], [7, 6], [5, 4, 5]]

reactions_puzzle = [['ORE', 'DQFL'], ['HGCR', 'TKRT', 'ZBLC'], ['MZQLG', 'RPLCK', 'PDTP', 'VCFX'], ['ZBLC', 'VFZX', 'SJQL'], ['CRPGK', 'TPRT'], ['HGCR', 'TGCW', 'VFZX', 'JBPHS'], ['GJHX', 'NSDBV'], ['VFTG', 'QNWD'], ['WDKW', 'DWRH', 'VNMV', 'HFHL', 'GJHX', 'NSDBV', 'KLJMS', 'KZDJ', 'FUEL'], ['JHSJ', 'JNWJ', 'ZMFXQ', 'GVRK'], ['PJFBD', 'MZQLG'], ['SJQL', 'LPVWN', 'DLZS'], ['PRMJ', 'XNWV', 'JHSJ'], ['SJQL', 'PJFBD'], ['QNWD', 'STHQ'], ['CNLFV', 'VFTG', 'XNWV'], ['LWNKB', 'KBWF', 'PLSCB', 'KZDJ'], ['LHWZQ', 'LWNKB', 'ZDWX'], ['RPLCK', 'LPVWN', 'ZMFXQ'], ['QNWD', 'TKRT', 'CRPGK'], ['JBPHS', 'XNWV', 'TLRST'], ['ZDWX', 'FZDP', 'CRPGK', 'PDTP'], ['JCVP', 'WXDVT'], ['CRPGK', 'FGVL'], ['DQFL', 'VNMV', 'HGCR'], ['GVRK', 'VCFX', 'PJFBD', 'PLSCB', 'FZDP', 'PCSM', 'JLVQ', 'HFHL'], ['CRPGK', 'PJFBD', 'XTCP', 'PLSCB'], ['HTZW', 'FGVL', 'LHWZQ'], ['KBWF', 'DQKLC'], ['LHWZQ', 'PRMJ'], ['DLZS', 'VCFX', 'PDTP', 'ZDWX', 'NBZC', 'JVMF', 'BGWMS', 'DWRH'], ['TKVCX', 'RPLCK', 'HTZW', 'XTCP'], ['CNLFV', 'NRSD', 'VFTG', 'VFZX'], ['TLRST', 'WDKW'], ['VFCZG', 'GJHX'], ['FZDP', 'JLVQ'], ['ZMFXQ', 'STHQ', 'QDZB'], ['SJQL', 'ZDWX', 'LPRL', 'WXDVT', 'TPRT', 'JNWJ', 'KLJMS'], ['JBPHS', 'ZBLC', 'HTZW'], ['PDTP', 'LHWZQ', 'JNWJ'], ['ZBLC', 'TKVCX'], ['WDKW', 'QDZB', 'PCSM'], ['GJHX', 'TKVCX', 'FZDP'], ['SJQL', 'PRMJ', 'JCVP'], ['CNLFV', 'TGCW'], ['TLRST', 'WDKW', 'KBWF'], ['ORE', 'VNMV'], ['ORE', 'CNLFV'], ['ORE', 'VFTG'], ['NRSD', 'STHQ', 'VFCZG'], ['LPVWN', 'KBWF', 'BGWMS'], ['BGWMS', 'SJQL', 'FZDP', 'NBZC'], ['ORE', 'NRSD'], ['HTZW', 'LPVWN'], ['PRMJ', 'JVMF'], ['PCSM', 'DQKLC', 'LPRL'], ['CNLFV', 'TKRT'], ['FZDP', 'LWNKB'], ['HTZW', 'RPLCK']]
numbers_puzzle = [[180, 9], [3, 9, 8], [1, 12, 8, 8], [3, 19, 1], [1, 4], [7, 4, 1, 9], [8, 4], [1, 2], [1, 2, 6, 2, 55, 4, 15, 17, 1], [2, 15, 1, 4], [1, 3], [1, 11, 9], [3, 2, 6], [4, 8], [14, 6], [5, 2, 9], [17, 6, 3, 8], [6, 5, 3], [5, 2, 8], [1, 2, 3], [1, 1, 6], [21, 3, 4, 6], [1, 1], [2, 9], [4, 2, 1], [2, 2, 3, 1, 23, 22, 1, 6], [1, 5, 4, 8], [1, 17, 3], [2, 4], [2, 2], [2, 2, 15, 14, 35, 20, 1, 3], [2, 6, 2, 4], [8, 1, 1, 9], [1, 4], [9, 7], [4, 8], [2, 2, 6], [2, 8, 6, 6, 1, 1, 8], [6, 2, 6], [1, 2, 8], [8, 7], [2, 31, 4], [15, 5, 7], [15, 3, 4], [31, 1], [1, 2, 9], [102, 7], [103, 5], [163, 2], [5, 1, 3], [16, 13, 2], [5, 11, 9, 6], [175, 7], [5, 4], [4, 7], [6, 8, 7], [2, 7], [3, 3], [1, 4]]

reactions = reactions_puzzle[:]
numbers = numbers_puzzle[:]

nums, reacts = [], []
look_to = {'FUEL': 1}
extra = {}
total = coefs = comps = 0

while True:
    for key1 in look_to:
        for key2 in extra:
            if key1 == key2:
                look_to[key1] -= extra[key2]
                extra[key2] = 0
    for comp, coef in look_to.items():
        for react, num in zip(reactions, numbers):
            if react[-1] == comp:
                nums = num[:]
                reacts = react[:]
                coefs = coef
                comps = comp
                break
    c = -1
    look_to.pop(comps)
    for n in nums[:-1]:
        c += 1
        if coefs % nums[-1] == 0:
            need_this = coefs//nums[-1]
        else:
            need_this = coefs//nums[-1] + 1
            extra[reacts[-1]] = nums[-1] * need_this - coefs
        try:
            look_to[reacts[c]] += n * need_this
        except KeyError:
            look_to[reacts[c]] = n * need_this

    keys = []
    if len(look_to) == 1:
        break

print(look_to)
